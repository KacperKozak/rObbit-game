{"version":3,"sources":["types/types.ts","config.ts","helpers.ts","objects/models/Items.tsx","objects/tileTypeDefinitions.tsx","audio/play.ts","types/consts.ts","objects/propTypeDefinitions.tsx","objects/definitions.ts","state/resolvers/flyResolver.ts","state/resolvers/moveResolver.ts","state/resolvers/grappleResolver.ts","state/gameReducer.ts","state/resolvers/rotateResolver.ts","state/gameEpics.ts","state/soundEpics.ts","state/store.ts","hooks/useEditor.ts","hooks/useKeyboardEvent.tsx","app/DebugView.tsx","app/Environment.tsx","data/maps.ts","app/GameInstance.tsx","hooks/useGame.ts","app/App.tsx","index.tsx"],"names":["ObjectTypes","CAMERA_OFFSET","applyVector","x","y","findById","props","id","find","prop","findByXY","objects","xy","filter","tile","x1","y1","x2","y2","samePosition","asArray","item","Array","isArray","arrMerge","a","b","limitVector","vector","min","max","map","v","value","Math","limit","vectorDiff","v1","v2","i","color","Fence","url","Asset","instance","elevation","rotation","castShadow","receiveShadow","elevationFix","anim","useSpring","pos","rot","vectorToThree","scene","useLoader","GLTFLoader","process","clone","children","scale","set","primitive","object","position","AnimatieAsset","data","gltf","gltfanimation","mixer","AnimationMixer","animations","forEach","clip","clipAction","play","useFrame","update","cannonInHeadScene","crossbowInHeadScene","group","visible","hasCannon","hasGrapple","AnimateSelfAsset","gltfScene","index","animation","setLoop","LoopOnce","PI","tileDebugComponent","style","width","height","backgroundColor","fontSize","tileTypeDefinitions","Grass","name","Component","Component3d","Ice","enter","who","move","targetId","RockFloor","soundList","button","music","Alert_NO","Alert_YES","Bazooka","Crossbow","Engine_start","Engine_LOOP_128","Engine_NO_1","Engine_NO_2","Engine_stop","Equip_1","Equip_2","Equip_3","Equip_4","Hero_1","Hero_2","Jump","volume","sound","Audio","playEquip","round","random","engineStart","UP","RIGHT","DOWN","LEFT","propDebugComponent","margin","borderRadius","type","Player","opacity","padding","propTypeDefinitions","BigRock","Box","push","self","force","remove","Button","state","console","warn","toggle","open","setObjectData","WinTrigger","win","attach","args","Dor","Cannon","equip","Boom","RocketProjectile","projectileLaunch","delay","projectileHit","what","tmpSpawn","uniqueId","aIndex","zIndex","CrossbowProjectile","objectDefinitions","getDefinition","def","Error","isTooHight","ontoObj","flyer","objDef","maxElevation","obj","initialState","queueStared","queue","mapId","mapName","cleanObjectsState","gameAction","actionCreatorFactory","queueAction","loadMap","reset","lose","enqueue","tryNextAction","nextAction","queueEnd","rotate","fall","projectile","fly","flyEnd","grapple","updateObject","gameReducer","reducerWithInitialState","case","cases","action","actions","addActions","target","newXY","newXYObjects","sort","length","objectValues","event","moveResolver","rotateResolver","equipResolver","byId","launchActions","abortResults","hitTargetId","flyResolver","undefined","hitActions","projectileInstance","prevXY","grappleResolver","setObjectDataResolver","myObjects","gameEpics","combineEpics","actions$","state$","pipe","match","game","mapTo","first","flatMap","newActionDelay","payload","meta","concat","of","soundEpics","tap","ignoreElements","epicMiddleware","createEpicMiddleware","composeEnhancers","composeWithDevTools","rootReducer","combineReducers","store","createStore","applyMiddleware","run","useEditor","useSelector","useState","editMode","setEditMode","dispatch","useDispatch","edit","toggleEditMode","copyMap","serializedMap","JSON","stringify","navigator","clipboard","writeText","then","log","error","useKeyboardEvent","key","callback","useEffect","handler","window","addEventListener","removeEventListener","DebugView","editId","setEditId","top","right","size","onClick","step","onChange","parseInt","Object","keys","left","isEmpty","Environment","objectsList","useThree","camera","xValues","yValues","mapCenterX","mapCenterY","offsetX","offsetY","offsetZ","lookAt","intensity","Color","shadow-mapSize-Height","shadow-mapSize-width","shadow-camera-far","shadow-bias","shadow-camera-left","shadow-camera-right","shadow-camera-top","shadow-camera-bottom","maps","GameInstance","player","isEqual","fire","useGame","up","down","mapCenter","el","bottom","textAlign","zoom","onCreated","gl","shadowMap","PCFSoftShadowMap","enabled","fallback","App","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.f6541110.chunk.js","sourcesContent":["import { GameState } from '../state/gameReducer'\nimport { Action } from 'redux'\nimport { FC, ReactNode } from 'react'\n\nexport type XY = [number, number]\nexport type Vector2 = [number, number]\n\nexport enum ObjectTypes {\n    Player = 'Player',\n    WinTrigger = 'WinTrigger',\n\n    Grass = 'Grass',\n    RockFloor = 'RockFloor',\n    Box = 'Box',\n    BigRock = 'BigRock',\n    Fence = 'Fence',\n\n    Button = 'Button',\n    Dor = 'Dor',\n    Ice = 'Ice',\n\n    Crossbow = 'Crossbow',\n    Cannon = 'Cannon',\n    Boom = 'Boom',\n\n    CrossbowProjectile = 'CrossbowProjectile',\n    RocketProjectile = 'RocketProjectile',\n}\n\nexport interface ObjectInstance {\n    type: ObjectTypes\n    id: string\n    xy: XY\n    rotation: Vector2\n    elevation: number\n    zIndex: number\n    aIndex: number\n    data: Partial<ObjectInstanceData>\n}\n\nexport interface ObjectInstanceData {\n    hasCannon: boolean\n    hasGrapple: boolean\n    info: string\n    open: boolean\n    targetId: string\n}\n\nexport interface ActionEvent {\n    who: ObjectInstance\n    self: ObjectInstance\n    what?: ObjectInstance\n    vector: Vector2\n    state: GameState\n    force?: number\n}\n\nexport interface ObjectDefinition {\n    name: string\n    height: (instance: ObjectInstance) => number\n    push?(event: ActionEvent): Action[] // triggered when elevation is to big\n    enter?(event: ActionEvent): Action[]\n    leave?(event: ActionEvent): Action[]\n    equip?(event: ActionEvent): Action[]\n    projectileLaunch?(event: ActionEvent): Action[] // eg. for projectile\n    projectileHit?(event: ActionEvent): Action[] // eg. for projectile\n    Component(props: RenderComponentProps & { children: ReactNode }): any\n    Component3d(props: RenderComponentProps): any\n}\n\nexport interface RenderComponentProps {\n    instance: ObjectInstance\n}\n\nexport interface MapData {\n    id: string\n    name: string\n    objects: ObjectInstance[]\n}\n","export const CAMERA_OFFSET = [-2, 4, 6]\n\nexport const MAX_MOVE_ELEVATION = 0.5\n\nexport const PROJECTILE_ELEVATION = 0.8\n\nexport const GRAPPLE_RANGE = 5\nexport const GRAPPLE_ELEVATION = 0.5\nexport const GRAPPLE_MOVE_DELAY = 300\n\nexport const DEFAULT_ACTION_DELAY = 65\n\nexport const FALL_TRIGGER_DELAY = 400\nexport const FALL_REMOVE_DELAY = 800\nexport const FALL_ELEVATION = -5\n","import { XY, Vector2 } from './types/types'\n\nexport const reverseVector = (vector: Vector2) => vector.map(v => v * -1) as Vector2\n\nexport const applyVector = ([x, y]: XY, [vx, vy]: Vector2): XY => [x + vx, y + vy]\n\nexport const samePosition = ([x1, y1]: XY, [x2, y2]: XY) => x1 === x2 && y1 === y2\n\nexport const findById = <T extends { id: string }>(props: T[], id: string) => {\n    return props.find(prop => prop.id === id)\n}\n\nexport const findByXY = <T extends { xy: XY }>(objects: T[], xy: XY) => {\n    return objects.filter(tile => samePosition(tile.xy, xy))\n}\n\nexport const asArray = <T>(item: T | T[]): T[] => (Array.isArray(item) ? item : [item])\nexport const arrMerge = <T>(a: T[], b: T | T[] = []): T[] => [...a, ...asArray(b)]\n\nexport const limit = (value: number, min: number, max: number) =>\n    Math.min(max, Math.max(min, value))\n\nexport const limitVector = (vector: Vector2, min: number, max: number) =>\n    vector.map(v => limit(v, min, max)) as Vector2\n\nexport const vectorDiff = (v1: Vector2, v2: Vector2) => v1.map((v, i) => v2[i] - v) as Vector2\n","import React, { useEffect } from 'react'\nimport { useLoader, useFrame } from 'react-three-fiber'\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\nimport { RenderComponentProps, Vector2 } from '../../types/types'\nimport { AnimationMixer, Group, LoopOnce } from 'three'\nimport { setInterval } from 'timers'\nimport { useSpring, animated } from 'react-spring/three'\nimport { timeInterval } from 'rxjs/operators'\n\nexport const Player = (props: RenderComponentProps) => {\n    return <AnimatieAsset {...props} url=\"robot_model.gltf\" />\n}\n\nexport const Box = (props: RenderComponentProps) => {\n    return <Asset {...props} url=\"box.gltf\" />\n}\n\nexport const Rock = (props: RenderComponentProps) => {\n    return <Asset {...props} url=\"rock1.gltf\" />\n}\n\nexport const Fence = (props: RenderComponentProps) => {\n    return <Asset {...props} url=\"fence.gltf\" />\n}\n\nexport const Arrow = (props: RenderComponentProps) => {\n    return <Asset {...props} url=\"arrow.gltf\" />\n}\n\nexport const Boom = (props: RenderComponentProps) => {\n    return <AnimateSelfAsset {...props} url=\"boom.gltf\" />\n}\n\nexport const Cannon = (props: RenderComponentProps) => {\n    return <Asset {...props} url=\"rakietnica_srednia.gltf\" elevationFix={-0.8} />\n}\n\nexport const Rocket = (props: RenderComponentProps) => {\n    return <Asset {...props} url=\"rocket.gltf\" />\n}\n\nexport const Crossbow = (props: RenderComponentProps) => {\n    return <Asset {...props} url=\"kusza.gltf\" elevationFix={-0.8} />\n}\n\nexport const Ground = (props: RenderComponentProps) => {\n    return <Asset {...props} url=\"rock.gltf\" castShadow={true} receiveShadow={true} />\n}\n\nexport const Grass = (props: RenderComponentProps) => {\n    return (\n        <Asset\n            {...props}\n            url=\"grass_002_export_test_1_cube.gltf\" // INNY model\n            castShadow={false}\n            receiveShadow={true}\n        />\n    )\n}\n\nexport const Ice = (props: RenderComponentProps) => {\n    return (\n        <Asset\n            {...props}\n            url=\"ice_002_export_test_1_cube.gltf\" // INNY model\n            castShadow={false}\n            receiveShadow={true}\n        />\n    )\n}\n\nexport const Button = (props: RenderComponentProps) => {\n    return (\n        <Asset\n            {...props}\n            url=\"ground_002_export_test_1_cube.gltf\" // INNY model\n            castShadow={false}\n            receiveShadow={true}\n        />\n    )\n}\n\nexport const createTrigger = (color: string) => ({ instance }: RenderComponentProps) => {\n    const { xy, elevation, rotation } = instance\n\n    return (\n        <mesh position={[xy[0], elevation, xy[1]]} rotation={[0, vectorToThree(rotation), 0]}>\n            <boxBufferGeometry attach=\"geometry\" args={[0.5, 1, 0.5]} />\n            <meshStandardMaterial attach=\"material\" color={color} />\n        </mesh>\n    )\n}\n\ninterface AssetProps extends RenderComponentProps {\n    url: string\n    color?: string\n    castShadow?: boolean\n    receiveShadow?: boolean\n    elevationFix?: number\n}\n\nconst Asset = ({\n    url,\n    instance: { xy, elevation, rotation },\n    castShadow = true,\n    receiveShadow = true,\n    elevationFix = 0,\n}: AssetProps) => {\n    const anim = useSpring({\n        pos: [xy[0], elevation + elevationFix, xy[1]],\n        rot: [0, vectorToThree(rotation), 0],\n    })\n    const gltf = useLoader(GLTFLoader, `${process.env.PUBLIC_URL}/assets/${url}`)\n    const scene = gltf.scene.clone()\n    if (castShadow) scene.children[0].castShadow = true\n    if (receiveShadow) scene.children[0].receiveShadow = true\n    scene.scale.set(0.5, 0.5, 0.5)\n    return <animated.primitive object={scene} position={anim.pos} rotation={anim.rot} />\n}\n\nconst AnimatieAsset = ({\n    url,\n    instance: { xy, elevation, rotation, data },\n    castShadow = true,\n    receiveShadow = true,\n}: AssetProps) => {\n    const anim = useSpring({\n        pos: [xy[0], elevation, xy[1]],\n        rot: [0, vectorToThree(rotation), 0],\n    })\n\n    const gltf = useLoader(GLTFLoader, `${process.env.PUBLIC_URL}/assets/${url}`)\n    gltf.scene.scale.set(0.5, 0.5, 0.5)\n    if (castShadow) gltf.scene.children[0].castShadow = true\n    if (receiveShadow) gltf.scene.children[0].receiveShadow = true\n\n    // const gltfanimation = useLoader(GLTFLoader, `/assets/animations/jump.gltf`)\n    // const gltfanimation = useLoader(GLTFLoader, `/assets/animations/move.gltf`)\n    const gltfanimation = useLoader(\n        GLTFLoader,\n        `${process.env.PUBLIC_URL}/assets/animations/boring.gltf`,\n    )\n    const mixer = new AnimationMixer(gltfanimation.scene)\n    gltfanimation.animations.forEach(clip => {\n        mixer.clipAction(clip, gltf.scene).play()\n    })\n    useFrame(() => mixer.update(0.02))\n\n    const cannonInHead = useLoader(\n        GLTFLoader,\n        `${process.env.PUBLIC_URL}/assets/rakietnica_srednia.gltf`,\n    )\n    const cannonInHeadScene = cannonInHead.scene.clone()\n\n    const crossbowInHead = useLoader(GLTFLoader, `${process.env.PUBLIC_URL}/assets/kusza.gltf`)\n    const crossbowInHeadScene = crossbowInHead.scene.clone()\n\n    return (\n        <animated.group position={anim.pos} rotation={anim.rot}>\n            <primitive object={gltf.scene}>\n                <primitive object={cannonInHeadScene} visible={!!data.hasCannon} />\n                <primitive object={crossbowInHeadScene} visible={!!data.hasGrapple} />\n            </primitive>\n        </animated.group>\n    )\n}\n\nconst AnimateSelfAsset = ({\n    url,\n    instance: { xy, elevation, rotation, data },\n    castShadow = true,\n    receiveShadow = true,\n}: AssetProps) => {\n    const anim = useSpring({\n        pos: [xy[0], elevation, xy[1]],\n        rot: [0, vectorToThree(rotation), 0],\n    })\n    const gltf = useLoader(GLTFLoader, `${process.env.PUBLIC_URL}/assets/${url}`)\n\n    const gltfScene = gltf.scene.clone()\n    // useEffect(() => {\n    if (castShadow) gltfScene.children[0].castShadow = true\n    if (receiveShadow) gltfScene.children[0].receiveShadow = true\n\n    gltfScene.scale.set(0.6, 0.6, 0.6)\n\n    const mixer = new AnimationMixer(gltfScene)\n\n    gltf.animations.forEach((clip, index) => {\n        const animation = mixer.clipAction(clip, gltfScene.children[index])\n        animation.setLoop(LoopOnce, 1)\n        animation.play()\n    })\n    // }, [xy])\n    useFrame(() => {\n        mixer.update(0.03)\n    })\n\n    return (\n        <animated.group position={anim.pos} rotation={anim.rot}>\n            <primitive object={gltfScene} />\n        </animated.group>\n    )\n}\n\nconst vectorToThree = (vector: Vector2) => {\n    if (vector[0] === 1 && vector[1] === 0) return Math.PI / 2\n    if (vector[0] === 0 && vector[1] === -1) return (Math.PI / 2) * 2\n    if (vector[0] === -1 && vector[1] === 0) return (Math.PI / 2) * 3\n    if (vector[0] === 0 && vector[1] === 1) return (Math.PI / 2) * 4\n    // return (Math.PI / 2) * 4\n    return 0\n}\n\n// export const box = (props: RenderComponentProps) => {\n//     return (\n//         <mesh>\n//             <boxBufferGeometry attach=\"geometry\" args={[0.5, 0.5, 0.5]} />\n//             <meshStandardMaterial attach=\"material\" color={props.color} />\n//         </mesh>\n//     )\n// }\n","import React from 'react'\nimport { limitVector } from '../helpers'\nimport { move } from '../state/gameReducer'\nimport { ObjectDefinition, ObjectTypes } from '../types/types'\nimport { Grass, Ground, Ice } from './models/Items'\n\nconst tileDebugComponent = (color: string) => (props: any) => (\n    <div\n        style={{ width: '100%', height: '100%', backgroundColor: color, fontSize: 9 }}\n        {...props}\n    />\n)\n\nexport const tileTypeDefinitions: Partial<Record<ObjectTypes, ObjectDefinition>> = {\n    [ObjectTypes.Grass]: {\n        name: 'Grass',\n        height: () => 0,\n        Component: tileDebugComponent('green'),\n        Component3d: Grass,\n    },\n\n    [ObjectTypes.Ice]: {\n        name: 'Ice',\n        height: () => 0,\n        enter: ({ who, vector }) => [\n            move({ targetId: who.id, vector: limitVector(vector, -1, 1) }),\n        ],\n        Component: tileDebugComponent('lightblue'),\n        Component3d: Ice,\n    },\n\n    [ObjectTypes.RockFloor]: {\n        name: 'Rock floor',\n        height: () => 0,\n        Component: tileDebugComponent('gray'),\n        Component3d: Ground,\n    },\n}\n","const soundList = {\n    button: `${process.env.PUBLIC_URL}/sounds/Button_gameplay.mp3`,\n    music: `${process.env.PUBLIC_URL}/sounds/elementary1.mp3`,\n    Alert_NO: `${process.env.PUBLIC_URL}/sounds/Alert_NO.mp3`,\n    Alert_YES: `${process.env.PUBLIC_URL}/sounds/Alert_YES.mp3`,\n    Bazooka: `${process.env.PUBLIC_URL}/sounds/Bazooka.mp3`,\n    Crossbow: `${process.env.PUBLIC_URL}/sounds/Crossbow.mp3`,\n    Engine_start: `${process.env.PUBLIC_URL}/sounds/Engine_start.mp3`,\n    Engine_LOOP_128: `${process.env.PUBLIC_URL}/sounds/Engine_LOOP_128.mp3`,\n    Engine_NO_1: `${process.env.PUBLIC_URL}/sounds/Engine_NO_1.mp3`,\n    Engine_NO_2: `${process.env.PUBLIC_URL}/sounds/Engine_NO_2.mp3`,\n    Engine_stop: `${process.env.PUBLIC_URL}/sounds/Engine_stop.mp3`,\n    Equip_1: `${process.env.PUBLIC_URL}/sounds/Equip_1.mp3`,\n    Equip_2: `${process.env.PUBLIC_URL}/sounds/Equip_2.mp3`,\n    Equip_3: `${process.env.PUBLIC_URL}/sounds/Equip_3.mp3`,\n    Equip_4: `${process.env.PUBLIC_URL}/sounds/Equip_4.mp3`,\n    Hero_1: `${process.env.PUBLIC_URL}/sounds/Hero_1.mp3`,\n    Hero_2: `${process.env.PUBLIC_URL}/sounds/Hero_2.mp3`,\n    Jump: `${process.env.PUBLIC_URL}/sounds/Jump.mp3`,\n}\n\nexport type SoundName = keyof typeof soundList\n\nexport const play = (name: SoundName, volume?: number) => {\n    const sound = new Audio(soundList[name])\n    if (volume) sound.volume = volume\n    sound.play()\n    // sound.addEventListener('ended', () => {\n    //     sound.play()\n    // })\n}\nexport const playEquip = (volume?: number) => {\n    const list = ['Equip_1', 'Equip_2', 'Equip_3', 'Equip_4']\n    play(list[Math.round(Math.random() * 4)] as SoundName, volume)\n}\n\nconst engineStart = new Audio(soundList['Engine_LOOP_128'])\n\nexport const playEngine = (volume?: number) => {\n    if (volume) engineStart.volume = volume\n    // const playEnd = () => {\n    //     play('Engine_stop', volume)\n    //     engineStart.removeEventListener('ended', playEnd)\n    // }\n    engineStart.play()\n    // engineStart.removeEventListener('ended', playEnd)\n    // engineStart.addEventListener('ended', playEnd)\n}\n","import { Vector2 } from './types'\n\nexport const PLAYER_ID = 'player'\n\nexport const UP: Vector2 = [0, -1]\nexport const RIGHT: Vector2 = [1, 0]\nexport const DOWN: Vector2 = [0, 1]\nexport const LEFT: Vector2 = [-1, 0]\n","import React from 'react'\nimport { playEquip, play } from '../audio/play'\nimport { move, remove, setObjectData, tmpSpawn, win } from '../state/gameReducer'\nimport { ObjectDefinition, ObjectTypes } from '../types/types'\nimport {\n    Cannon,\n    Crossbow,\n    Player,\n    Rock,\n    Rocket,\n    Box,\n    Boom,\n    Fence,\n    Arrow,\n    Button,\n    createTrigger,\n} from './models/Items'\nimport { reverseVector } from '../helpers'\nimport { uniqueId, sample } from 'lodash'\nimport { PLAYER_ID } from '../types/consts'\n\nconst propDebugComponent = (color: string) => ({ instance, children }: any) => {\n    return (\n        <div\n            style={{\n                margin: '20%',\n                width: '60%',\n                height: '60%',\n                borderRadius: instance.type === ObjectTypes.Player ? 100 : 5,\n                backgroundColor: color,\n                color: 'black',\n                opacity: 0.7,\n            }}\n        >\n            <pre style={{ padding: 2, fontSize: 8 }}>{children}</pre>\n        </div>\n    )\n}\n\nexport const propTypeDefinitions: Partial<Record<ObjectTypes, ObjectDefinition>> = {\n    [ObjectTypes.Player]: {\n        name: 'Player',\n        height: () => 2,\n        Component: propDebugComponent('white'),\n        Component3d: Player,\n    },\n\n    [ObjectTypes.BigRock]: {\n        name: 'Big rock',\n        height: () => 0.55,\n        Component: propDebugComponent('gray'),\n        Component3d: Rock,\n    },\n    [ObjectTypes.Box]: {\n        name: 'Box',\n        height: () => 1,\n        push: ({ self, vector }) => [move({ targetId: self.id, vector })],\n        Component: propDebugComponent('brown'),\n        Component3d: Box,\n    },\n\n    [ObjectTypes.Fence]: {\n        name: 'Fence',\n        height: () => 1.5,\n        push: ({ force, self }) => {\n            if (force && force >= 50) return [remove(self.id)]\n            return []\n        },\n        Component: propDebugComponent('brown'),\n        Component3d: Fence,\n    },\n\n    [ObjectTypes.Button]: {\n        name: 'Button',\n        height: () => 2,\n        push: ({ state, self }) => {\n            play('button')\n            if (!self.data.targetId) {\n                console.warn('Missing Button data.targetId')\n                return []\n            }\n            const toggle = !self.data.open\n            return [\n                setObjectData({ targetId: self.id, data: { open: toggle } }),\n                setObjectData({ targetId: self.data.targetId, data: { open: toggle } }),\n            ]\n        },\n        Component: propDebugComponent('blue'),\n        Component3d: Fence,\n    },\n\n    [ObjectTypes.WinTrigger]: {\n        name: 'WinTrigger',\n        height: () => 0,\n        enter: ({ who, state, self }) => {\n            if (who.id === PLAYER_ID) {\n                play('Engine_start')\n                return [win()]\n            }\n            return []\n        },\n        Component: propDebugComponent('#ABC123'),\n        Component3d: createTrigger('#ABC123'),\n    },\n\n    [ObjectTypes.Dor]: {\n        name: 'Dor',\n        height: instance => {\n            return instance.data.open ? 0 : 1.5\n        },\n        push: ({ force, self }) => {\n            if (force && force >= 50) return [remove(self.id)]\n            return []\n        },\n        Component: propDebugComponent('purple'),\n        Component3d: Fence,\n    },\n\n    [ObjectTypes.Cannon]: {\n        name: 'Cannon',\n        height: () => 0,\n        equip: ({ who, self }) => {\n            playEquip(0.8)\n            return [setObjectData({ targetId: who.id, data: { hasCannon: true } }), remove(self.id)]\n        },\n        Component: propDebugComponent('red'),\n        Component3d: Cannon,\n    },\n\n    [ObjectTypes.Boom]: {\n        name: 'Boom',\n        height: () => 0,\n        Component: propDebugComponent('yellow'),\n        Component3d: Boom,\n    },\n\n    [ObjectTypes.Crossbow]: {\n        name: 'Crossbow',\n        height: () => 0,\n        equip: ({ who, self }) => {\n            playEquip(0.8)\n            return [\n                setObjectData({ targetId: who.id, data: { hasGrapple: true } }),\n                remove(self.id),\n            ]\n        },\n        Component: propDebugComponent('red'),\n        Component3d: Crossbow,\n    },\n\n    [ObjectTypes.RocketProjectile]: {\n        name: 'RocketProjectile',\n        height: () => 0,\n        projectileLaunch: ({ who }) => {\n            play('Bazooka')\n            return [\n                move(\n                    { targetId: who.id, vector: reverseVector(who.rotation) },\n                    { delay: 250 }, // delay remove from projectileHit\n                ),\n            ]\n        },\n        projectileHit: ({ self, what, who }) => {\n            if (!what) {\n                return [remove(self.id)]\n            }\n\n            play('Alert_YES') // TODO Boom!\n            return [\n                remove(self.id),\n                tmpSpawn({\n                    instance: {\n                        type: ObjectTypes.Boom,\n                        id: uniqueId(),\n                        xy: self.xy,\n                        elevation: self.elevation,\n                        rotation: self.rotation,\n                        aIndex: 0,\n                        zIndex: 20,\n                        data: {},\n                    },\n                }),\n            ]\n        },\n        Component: propDebugComponent('yellow'),\n        Component3d: Rocket,\n    },\n\n    [ObjectTypes.CrossbowProjectile]: {\n        name: 'Projectile',\n        height: () => 0,\n        projectileLaunch: ({ who }) => {\n            play('Crossbow')\n            return [\n                move(\n                    { targetId: who.id, vector: [0, 0] },\n                    { delay: 250 }, // delay remove from projectileHit\n                ),\n            ]\n        },\n        projectileHit: ({ self, what, who }) => {\n            if (what) {\n                play('Alert_YES') // TODO Hit!\n            }\n            return [remove(self.id)]\n        },\n        Component: propDebugComponent('pink'),\n        Component3d: Arrow,\n    },\n}\n","import { ObjectDefinition, ObjectTypes } from '../types/types'\nimport { tileTypeDefinitions } from './tileTypeDefinitions'\nimport { propTypeDefinitions } from './propTypeDefinitions'\n\nexport const objectDefinitions: Partial<Record<ObjectTypes, ObjectDefinition>> = {\n    ...tileTypeDefinitions,\n    ...propTypeDefinitions,\n}\n\nexport const getDefinition = (type: ObjectTypes): ObjectDefinition => {\n    const def = objectDefinitions[type]\n\n    if (!def) throw new Error(`[getDefinition] Definition for ${type} not found`)\n\n    return def\n}\n","import { Action } from 'redux'\nimport { applyVector, asArray, findById, findByXY } from '../../helpers'\nimport { getDefinition } from '../../objects/definitions'\nimport { ActionEvent, ObjectInstance } from '../../types/types'\nimport { GameState, flyEnd } from '../gameReducer'\nimport { ResolverResults } from './types'\n\nexport const flyResolver = (state: GameState, targetId: string): ResolverResults => {\n    let objects = state.objects\n    const actions: Action[] = []\n    const addActions = (a: Action | Action[] = []) => actions.push(...asArray(a))\n    const abortResults = { objects, actions }\n\n    const target = findById(objects, targetId)\n\n    if (!target) {\n        console.warn(`[move] Target ${targetId} not found`)\n        return abortResults\n    }\n\n    const vector = target.rotation\n    let xy = target.xy\n\n    let limit = 15\n\n    while (limit) {\n        limit--\n\n        xy = applyVector(xy, vector)\n        const newXYObjects = findByXY(objects, xy).sort((a, b) => b.aIndex - a.aIndex)\n\n        for (const obj of newXYObjects) {\n            const objDef = getDefinition(obj.type)\n            const event: ActionEvent = { who: target, vector, state, self: obj, force: 100 }\n\n            if (isTooHight(obj, target)) {\n                objects = objects.map(obj => {\n                    if (obj !== target) return obj\n                    return { ...obj, xy }\n                })\n\n                addActions(flyEnd({ targetId, hitTargetId: obj.id }))\n                addActions(objDef.push?.(event))\n                return { objects, actions }\n            }\n        }\n    }\n\n    addActions(flyEnd({ targetId }))\n\n    objects = objects.map(obj => {\n        if (obj !== target) return obj\n        return { ...obj, xy }\n    })\n\n    return { objects, actions }\n}\n\nconst isTooHight = (ontoObj: ObjectInstance, flyer: ObjectInstance) => {\n    const objDef = getDefinition(ontoObj.type)\n    return ontoObj.elevation + objDef.height(ontoObj) > flyer.elevation\n}\n","import { Action } from 'redux'\nimport { FALL_REMOVE_DELAY, FALL_TRIGGER_DELAY, MAX_MOVE_ELEVATION } from '../../config'\nimport { applyVector, asArray, findById, findByXY } from '../../helpers'\nimport { getDefinition } from '../../objects/definitions'\nimport { PLAYER_ID } from '../../types/consts'\nimport { ActionEvent, ObjectInstance, Vector2 } from '../../types/types'\nimport { fall, GameState, lose, remove, updateObject } from '../gameReducer'\nimport { ResolverResults } from './types'\n\nexport const moveResolver = (\n    state: GameState,\n    targetId: string,\n    vector: Vector2,\n): ResolverResults => {\n    let objects = state.objects\n    const actions: Action[] = []\n    const addActions = (a: Action | Action[] = []) => actions.push(...asArray(a))\n\n    const target = findById(objects, targetId)\n\n    if (!target) {\n        console.warn(`[move] Target ${targetId} not found`)\n        return { objects, actions }\n    }\n\n    const newXY = applyVector(target.xy, vector)\n    const newXYObjects = findByXY(objects, newXY).sort((a, b) => b.aIndex - a.aIndex)\n\n    // Nothing there, fall and die\n    if (!newXYObjects.length) {\n        addActions([\n            updateObject({ targetId, objectValues: { xy: newXY } }, { delay: FALL_TRIGGER_DELAY }),\n            fall({ targetId }, { delay: FALL_REMOVE_DELAY }),\n            targetId === PLAYER_ID ? lose() : remove(targetId),\n        ])\n        return { objects, actions }\n    }\n\n    // Can enter to this region?\n    for (const obj of newXYObjects) {\n        const objDef = getDefinition(obj.type)\n        const event: ActionEvent = { who: target, vector, state, self: obj }\n\n        if (isTooHight(obj, target)) {\n            addActions(objDef.push?.(event))\n            return { objects, actions }\n        }\n    }\n\n    // Move target to new location\n    objects = objects.map(obj => {\n        if (obj !== target) return obj\n        return { ...obj, xy: newXY, elevation: maxElevation(newXYObjects) }\n    })\n\n    // Post enter events\n    for (const obj of newXYObjects) {\n        const objDef = getDefinition(obj.type)\n        const event: ActionEvent = { who: target, vector, state, self: obj }\n        addActions(objDef.enter?.(event))\n    }\n\n    return { objects, actions }\n}\n\nconst maxElevation = (objects: ObjectInstance[]): number =>\n    Math.max(\n        ...objects.map(obj => {\n            const objDef = getDefinition(obj.type)\n            return objDef.height(obj) + obj.elevation\n        }),\n    )\n\nconst isTooHight = (ontoObj: ObjectInstance, who: ObjectInstance) => {\n    const objDef = getDefinition(ontoObj.type)\n    return ontoObj.elevation + objDef.height(ontoObj) - who.elevation > MAX_MOVE_ELEVATION\n}\n","import { uniqueId } from 'lodash'\nimport { Action } from 'redux'\nimport {\n    GRAPPLE_ELEVATION,\n    PROJECTILE_ELEVATION,\n    GRAPPLE_MOVE_DELAY,\n    GRAPPLE_RANGE,\n} from '../../config'\nimport { applyVector, asArray, findById, findByXY, vectorDiff } from '../../helpers'\nimport { getDefinition } from '../../objects/definitions'\nimport { ObjectInstance, ObjectTypes, Vector2 } from '../../types/types'\nimport { GameState, move, tmpSpawn, updateObject } from '../gameReducer'\nimport { ResolverResults } from './types'\n\nexport const grappleResolver = (state: GameState, targetId: string): ResolverResults => {\n    let objects = state.objects\n    const actions: Action[] = []\n    const addActions = (a: Action | Action[] = []) => actions.push(...asArray(a))\n    const abortResults = { objects, actions }\n\n    const target = findById(objects, targetId)\n\n    if (!target) {\n        console.warn(`[grappleResolver] Target ${targetId} not found`)\n        return abortResults\n    }\n\n    const projectileInstance: ObjectInstance = {\n        type: ObjectTypes.CrossbowProjectile,\n        id: uniqueId(),\n        xy: target.xy,\n        rotation: target.rotation,\n        elevation: target.elevation + PROJECTILE_ELEVATION,\n        aIndex: 100,\n        zIndex: 10,\n        data: {},\n    }\n\n    const vector = target.rotation\n    let xy = target.xy\n\n    let limit = GRAPPLE_RANGE\n\n    while (limit) {\n        limit--\n\n        const prevXY = xy\n        xy = applyVector(xy, vector)\n        const newXYObjects = findByXY(objects, xy).sort((a, b) => b.aIndex - a.aIndex)\n\n        for (const obj of newXYObjects) {\n            if (isTooHight(obj, target)) {\n                addActions(tmpSpawn({ instance: projectileInstance }))\n                addActions(\n                    updateObject(\n                        { targetId: projectileInstance.id, objectValues: { xy } },\n                        { delay: GRAPPLE_MOVE_DELAY },\n                    ),\n                )\n                addActions(\n                    move({\n                        targetId,\n                        vector: vectorDiff(target.xy, prevXY),\n                    }),\n                )\n\n                return { objects, actions }\n            }\n        }\n    }\n\n    return abortResults\n}\n\nconst isTooHight = (ontoObj: ObjectInstance, flyer: ObjectInstance) => {\n    const objDef = getDefinition(ontoObj.type)\n    return ontoObj.elevation + objDef.height(ontoObj) > flyer.elevation + GRAPPLE_ELEVATION\n}\n","import { uniqueId } from 'lodash'\nimport { Action } from 'redux'\nimport actionCreatorFactory from 'typescript-fsa'\nimport { reducerWithInitialState } from 'typescript-fsa-reducers'\nimport { PROJECTILE_ELEVATION, FALL_ELEVATION } from '../config'\nimport { arrMerge, findById, findByXY } from '../helpers'\nimport { createMap } from '../mocks/mapMock'\nimport { getDefinition } from '../objects/definitions'\nimport {\n    ActionEvent,\n    ObjectInstance,\n    ObjectInstanceData,\n    ObjectTypes,\n    Vector2,\n    XY,\n    MapData,\n} from '../types/types'\nimport { flyResolver } from './resolvers/flyResolver'\nimport { moveResolver } from './resolvers/moveResolver'\nimport { rotateResolver } from './resolvers/rotateResolver'\nimport { ResolverResults } from './resolvers/types'\nimport { grappleResolver } from './resolvers/grappleResolver'\n\nexport interface GameState {\n    queueStared: boolean\n    queue: Action[]\n    mapId: string | null\n    mapName: string | null\n    objects: ObjectInstance[]\n    cleanObjectsState: ObjectInstance[]\n}\n\nexport interface GameStateAware {\n    game: GameState\n}\n\n// const mockObjects = createMap()\n\nexport const initialState: GameState = {\n    queueStared: false,\n    queue: [],\n    mapId: null,\n    mapName: null,\n    objects: [],\n    cleanObjectsState: [],\n}\n\nconst gameAction = actionCreatorFactory('GG')\nconst queueAction = actionCreatorFactory('QUEUE')\n\nexport const loadMap = gameAction<MapData>('LOAD_MAP')\nexport const reset = gameAction('RESET')\nexport const win = gameAction('WIN')\nexport const lose = gameAction('LOSE')\n\nexport const enqueue = queueAction<Action | Action[]>('ENQUEUE')\nexport const tryNextAction = queueAction('TRY_NEXT_ACTION')\nexport const nextAction = queueAction<Action>('NEXT_ACTION')\nexport const queueEnd = queueAction('QUEUE_END')\n\nexport const move = gameAction<{ targetId: string; vector: Vector2 }>('MOVE')\nexport const rotate = gameAction<{ targetId: string; rotation: Vector2 }>('ROTATE')\nexport const equip = gameAction<{ targetId: string }>('EQUIP')\nexport const fall = gameAction<{ targetId: string }>('FALL')\n\nexport const projectile = gameAction<{ instance: ObjectInstance; byId: string }>('PROJECTILE')\nexport const fly = gameAction<{ targetId: string }>('FLY')\nexport const flyEnd = gameAction<{ targetId: string; hitTargetId?: string }>('FLY_END')\nexport const grapple = gameAction<{ targetId: string }>('GRAPPLE')\n\nexport const updateObject = gameAction<{\n    targetId: string\n    objectValues: Partial<ObjectInstance>\n}>('UPDATE_OBJECT')\nexport const setObjectData = gameAction<{\n    targetId: string\n    data: Partial<ObjectInstanceData>\n}>('SET_OBJECT_DATA')\nexport const remove = gameAction<string>('REMOVE')\nexport const tmpSpawn = gameAction<{ instance: ObjectInstance }>('TMP_SPAWN')\n\nexport const gameReducer = reducerWithInitialState(initialState)\n    /*\n     * Loading\n     */\n    .case(\n        loadMap,\n        (state, { id, name, objects }): GameState => ({\n            ...initialState,\n            mapId: id,\n            mapName: name,\n            objects,\n            cleanObjectsState: objects,\n        }),\n    )\n    .cases(\n        [reset, lose],\n        (state): GameState => ({\n            ...state,\n            queue: [],\n            queueStared: false,\n            objects: state.cleanObjectsState,\n            cleanObjectsState: state.cleanObjectsState,\n        }),\n    )\n    .case(\n        win,\n        (state): GameState => ({\n            ...initialState,\n        }),\n    )\n\n    /*\n     * Queue\n     */\n    .case(\n        enqueue,\n        (state, action): GameState => ({\n            ...state,\n            queue: arrMerge(state.queue, action),\n        }),\n    )\n    .case(\n        nextAction,\n        (state, action): GameState => ({\n            ...state,\n            queueStared: true,\n            queue: state.queue.filter(a => a !== action),\n        }),\n    )\n    .case(queueEnd, (state): GameState => ({ ...state, queueStared: false }))\n\n    /*\n     * User actions\n     */\n    .case(\n        move,\n        (state, { targetId, vector }): GameState => {\n            const { actions, objects } = moveResolver(state, targetId, vector)\n            return { ...state, objects, queue: arrMerge(state.queue, actions) }\n        },\n    )\n    .case(\n        rotate,\n        (state, { targetId, rotation }): GameState => {\n            const { actions, objects } = rotateResolver(state, targetId, rotation)\n            return { ...state, objects, queue: arrMerge(state.queue, actions) }\n        },\n    )\n    .case(\n        equip,\n        (state, { targetId }): GameState => {\n            const { actions, objects } = equipResolver(state, targetId)\n            return { ...state, objects, queue: arrMerge(state.queue, actions) }\n        },\n    )\n\n    /*\n     * Projectiles\n     */\n    .case(\n        projectile,\n        (state, { instance, byId }): GameState => {\n            const objDef = getDefinition(instance.type)\n            const objects = [...state.objects, instance]\n\n            const who = findById(state.objects, byId)!\n            const event: ActionEvent = { who, vector: instance.rotation, state, self: instance }\n\n            const launchActions = objDef.projectileLaunch?.(event) || []\n            const actions = [fly({ targetId: instance.id }), ...launchActions]\n\n            return { ...state, objects, queue: arrMerge(state.queue, actions) }\n        },\n    )\n    .case(\n        fly,\n        (state, { targetId }): GameState => {\n            const { actions, objects } = flyResolver(state, targetId)\n            return { ...state, objects, queue: arrMerge(state.queue, actions) }\n        },\n    )\n    .case(\n        flyEnd,\n        (state, { targetId, hitTargetId }): GameState => {\n            const obj = findById(state.objects, targetId)\n            const what = hitTargetId ? findById(state.objects, hitTargetId) : undefined\n\n            const actions: Action[] = []\n            if (obj) {\n                const objDef = getDefinition(obj.type)\n                const event: ActionEvent = {\n                    who: null as any, // TODO,\n                    what,\n                    vector: obj.rotation,\n                    state,\n                    self: obj,\n                }\n                const hitActions = objDef.projectileHit?.(event) || []\n                actions.push(...hitActions)\n            }\n            return { ...state, queue: arrMerge(state.queue, actions) }\n        },\n    )\n\n    /*\n     * Grapple\n     */\n    .case(\n        grapple,\n        (state, { targetId }): GameState => {\n            const { actions, objects } = grappleResolver(state, targetId)\n            return {\n                ...state,\n                objects,\n                queue: arrMerge(state.queue, actions),\n            }\n        },\n    )\n\n    /*\n     * Edit and internal actions\n     */\n    .case(\n        setObjectData,\n        (state, { targetId, data }): GameState => {\n            const { actions, objects } = setObjectDataResolver(state, targetId, data)\n            return { ...state, objects, queue: arrMerge(state.queue, actions) }\n        },\n    )\n    .case(\n        updateObject,\n        (state, { targetId, objectValues }): GameState => {\n            return {\n                ...state,\n                objects: state.objects.map(obj =>\n                    obj.id === targetId ? { ...obj, ...objectValues } : obj,\n                ),\n            }\n        },\n    )\n    .case(\n        fall,\n        (state, { targetId }): GameState => {\n            return {\n                ...state,\n                objects: state.objects.map(obj =>\n                    obj.id === targetId ? { ...obj, elevation: FALL_ELEVATION } : obj,\n                ),\n            }\n        },\n    )\n    .case(\n        remove,\n        (state, targetId): GameState => ({\n            ...state,\n            objects: state.objects.filter(obj => obj.id !== targetId),\n        }),\n    )\n    .case(\n        tmpSpawn,\n        (state, { instance }): GameState => ({\n            ...state,\n            objects: [...state.objects, instance],\n        }),\n    )\n\nexport const equipResolver = (state: GameState, targetId: string): ResolverResults => {\n    const actions: Action[] = []\n    const target = findById(state.objects, targetId)\n    if (!target) return { objects: state.objects, actions: [] }\n\n    const myObjects = findByXY(state.objects, target.xy).sort((a, b) => b.aIndex - a.aIndex)\n\n    for (const obj of myObjects) {\n        const objDef = getDefinition(obj.type)\n        const event: ActionEvent = { who: target, vector: [0, 0], state, self: obj }\n        actions.push(...(objDef.equip?.(event) || []))\n    }\n\n    return {\n        actions,\n        objects: state.objects,\n    }\n}\n\nexport const setObjectDataResolver = (\n    { objects }: GameState,\n    targetId: string,\n    data: Partial<ObjectInstanceData>,\n): ResolverResults => {\n    const target = findById(objects, targetId)\n\n    return {\n        objects: objects.map(obj => {\n            if (obj !== target) return obj\n            return { ...obj, data: { ...obj.data, ...data } }\n        }),\n        actions: [],\n    }\n}\n","import { findById } from '../../helpers'\nimport { Vector2 } from '../../types/types'\nimport { ResolverResults } from './types'\nimport { GameState } from '../gameReducer'\n\nexport const rotateResolver = (\n    { objects }: GameState,\n    targetId: string,\n    rotation: Vector2,\n): ResolverResults => {\n    const target = findById(objects, targetId)\n\n    return {\n        objects: objects.map(obj => {\n            if (obj !== target) return obj\n            return { ...obj, rotation }\n        }),\n        actions: [],\n    }\n}\n","import { first } from 'lodash'\nimport { Action } from 'redux'\nimport { combineEpics, StateObservable } from 'redux-observable'\nimport { concat, Observable, of } from 'rxjs'\nimport { delay, filter, flatMap, map, mapTo } from 'rxjs/operators'\nimport { DEFAULT_ACTION_DELAY } from '../config'\nimport {\n    enqueue,\n    GameStateAware,\n    nextAction,\n    queueEnd,\n    remove,\n    tmpSpawn,\n    tryNextAction,\n} from './gameReducer'\n\nconst enqueueEpic = (\n    actions$: Observable<Action>,\n    state$: StateObservable<GameStateAware>,\n): Observable<Action> =>\n    actions$.pipe(\n        filter(enqueue.match),\n        filter(() => !state$.value.game.queueStared),\n        mapTo(tryNextAction()),\n    )\n\nconst tryNextEpic = (\n    actions$: Observable<Action>,\n    state$: StateObservable<GameStateAware>,\n): Observable<Action> =>\n    actions$.pipe(\n        filter(tryNextAction.match),\n        map(() => first(state$.value.game.queue)),\n        map(action => (action ? nextAction(action) : queueEnd())),\n    )\n\nconst nextActionEpic = (\n    actions$: Observable<Action>,\n    state$: StateObservable<GameStateAware>,\n): Observable<Action> =>\n    actions$.pipe(\n        filter(nextAction.match),\n        flatMap(action => {\n            const newActionDelay = (action.payload as any).meta?.delay || DEFAULT_ACTION_DELAY\n            return concat(of(action.payload), of(tryNextAction()).pipe(delay(newActionDelay)))\n        }),\n    )\n\nconst tmpSpawnEpic = (\n    actions$: Observable<Action>,\n    state$: StateObservable<GameStateAware>,\n): Observable<Action> =>\n    actions$.pipe(\n        filter(tmpSpawn.match),\n        delay(1000),\n        map(action => remove(action.payload.instance.id)),\n    )\n\nexport const gameEpics = combineEpics(enqueueEpic, tryNextEpic, nextActionEpic, tmpSpawnEpic)\n","import { Action } from 'redux'\nimport { combineEpics } from 'redux-observable'\nimport { Observable } from 'rxjs'\nimport { filter, ignoreElements, tap } from 'rxjs/operators'\nimport { play, playEngine } from '../audio/play'\nimport { equip, move, lose, grapple } from './gameReducer'\nimport { PLAYER_ID } from '../types/consts'\n\nconst moveSoundEpic = (actions$: Observable<Action>): Observable<Action> =>\n    actions$.pipe(\n        filter(move.match),\n        filter(action => action.payload.targetId === PLAYER_ID),\n        tap(() => playEngine(0.1)),\n        ignoreElements(),\n    )\n\nconst equipSoundEpic = (actions$: Observable<Action>): Observable<Action> =>\n    actions$.pipe(\n        filter(equip.match),\n        tap(target => play('Hero_2', 0.7)),\n        ignoreElements(),\n    )\n\nconst loseSoundEpic = (actions$: Observable<Action>): Observable<Action> =>\n    actions$.pipe(\n        filter(lose.match),\n        tap(target => play('Engine_NO_2', 0.7)),\n        ignoreElements(),\n    )\n\nconst grappleSoundEpic = (actions$: Observable<Action>): Observable<Action> =>\n    actions$.pipe(\n        filter(grapple.match),\n        tap(target => play('Crossbow', 0.7)),\n        ignoreElements(),\n    )\n\nexport const soundEpics = combineEpics(\n    moveSoundEpic,\n    equipSoundEpic,\n    loseSoundEpic,\n    grappleSoundEpic,\n)\n","import { applyMiddleware, combineReducers, createStore } from 'redux'\nimport { composeWithDevTools } from 'redux-devtools-extension'\nimport { combineEpics, createEpicMiddleware } from 'redux-observable'\nimport { gameEpics } from './gameEpics'\nimport { gameReducer } from './gameReducer'\nimport { soundEpics } from './soundEpics'\n\nconst epicMiddleware = createEpicMiddleware()\n\nconst composeEnhancers = composeWithDevTools({\n    name: 'App',\n})\n\nconst rootReducer = combineReducers({\n    game: gameReducer,\n})\n\nexport const store = createStore(rootReducer, composeEnhancers(applyMiddleware(epicMiddleware)))\n\nepicMiddleware.run(combineEpics(soundEpics, gameEpics))\n","import { useState } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { GameStateAware, updateObject } from '../state/gameReducer'\nimport { ObjectInstance } from '../types/types'\n\nexport const useEditor = () => {\n    const state = useSelector((state: GameStateAware) => state.game)\n    const [editMode, setEditMode] = useState(false)\n    const dispatch = useDispatch()\n\n    const toggleEditMode = () => {\n        setEditMode(!editMode)\n    }\n\n    const edit = (targetId: string, objectValues: Partial<ObjectInstance>) => {\n        dispatch(updateObject({ targetId, objectValues }))\n    }\n\n    const copyMap = () => {\n        const serializedMap = JSON.stringify(state.objects)\n\n        navigator.clipboard.writeText(serializedMap).then(() => {\n            console.log('Copied to clipboard')\n        }, console.error)\n    }\n\n    return { edit, toggleEditMode, editMode, copyMap }\n}\n","import { useEffect } from 'react'\n\nexport const useKeyboardEvent = (key: string, callback: Function) => {\n    useEffect(() => {\n        const handler = (event: KeyboardEvent) => {\n            if (event.key === key) callback()\n        }\n\n        window.addEventListener('keydown', handler)\n\n        return () => window.removeEventListener('keydown', handler)\n    })\n}\n","import { isEmpty } from 'lodash'\nimport React, { useState } from 'react'\nimport { findById } from '../helpers'\nimport { useEditor } from '../hooks/useEditor'\nimport { getDefinition, objectDefinitions } from '../objects/definitions'\nimport { ObjectInstance, ObjectTypes } from '../types/types'\n\ninterface DebugViewProps {\n    objects: ObjectInstance[]\n}\n\nconst size = 60\n\nexport const DebugView = ({ objects }: DebugViewProps) => {\n    const [editId, setEditId] = useState<string>()\n    const { edit, copyMap } = useEditor()\n    const obj = editId && findById(objects, editId)\n    const update = (value: Partial<ObjectInstance>) => {\n        if (obj) edit(obj.id, value)\n    }\n\n    return (\n        <div\n            style={{\n                position: 'absolute',\n                zIndex: 100,\n                top: 0,\n                right: 0,\n                width: size * 8,\n                opacity: 0.8,\n            }}\n        >\n            <button onClick={copyMap}>Copy map</button>\n            {obj && (\n                <>\n                    <input\n                        type=\"range\"\n                        min={-1}\n                        max={5}\n                        step={0.01}\n                        value={obj.elevation}\n                        onChange={event => update({ elevation: parseInt(event.target.value, 10) })}\n                    />\n                    <select\n                        value={obj.type}\n                        onChange={event => update({ type: event.target.value as ObjectTypes })}\n                    >\n                        {Object.keys(objectDefinitions).map(item => (\n                            <option>{item}</option>\n                        ))}\n                    </select>\n                </>\n            )}\n            <div style={{ position: 'relative' }}>\n                {objects.map(obj => {\n                    const { type, id, xy, rotation, elevation, zIndex, data } = obj\n                    const { Component } = getDefinition(type)\n                    return (\n                        <div\n                            key={id}\n                            style={{\n                                position: 'absolute',\n                                left: xy[0] * size,\n                                top: xy[1] * size,\n                                width: size,\n                                height: size,\n                                zIndex,\n                            }}\n                            onClick={() => setEditId(id)}\n                        >\n                            <Component instance={obj}>\n                                {id} - {type} <br />\n                                {isEmpty(data) ? '' : JSON.stringify(data, null, 1)}\n                            </Component>\n                        </div>\n                    )\n                })}\n            </div>\n        </div>\n    )\n}\n\ninterface LabelProps {\n    text: string\n    bottom?: boolean\n}\n\nexport const Label = ({ text, bottom }: LabelProps) => (\n    <div\n        style={{\n            position: 'absolute',\n            left: 0,\n            top: bottom ? '80%' : 0,\n            fontSize: 10,\n            color: 'black',\n        }}\n    >\n        {text}\n    </div>\n)\n","import React, { useEffect } from 'react'\nimport { Color } from 'three'\nimport { useGame } from '../hooks/useGame'\nimport { useThree } from 'react-three-fiber'\nimport { ObjectInstance } from '../types/types'\nimport { CAMERA_OFFSET } from '../config'\n\nconst d = 5\n\ninterface EnvironmentProps {\n    // player: ObjectInstance,\n    mapId: string | null\n    objectsList: ObjectInstance[]\n}\n\nexport const Environment = ({ objectsList, mapId }: EnvironmentProps) => {\n    const { camera, size } = useThree()\n\n    useEffect(() => {\n        const xValues = objectsList.map(obj => obj.xy[0])\n        const yValues = objectsList.map(obj => obj.xy[1])\n\n        const mapCenterX = Math.max(...xValues) / 2\n        const mapCenterY = Math.max(...yValues) / 2\n\n        const offsetX =\n            (CAMERA_OFFSET[0] * Math.max(mapCenterX, mapCenterY) * 7) /\n            (size.width / size.height) /\n            0.9\n        const offsetY =\n            (CAMERA_OFFSET[1] * Math.max(mapCenterX, mapCenterY) * 7) /\n            (size.width / size.height) /\n            0.9\n        const offsetZ =\n            (CAMERA_OFFSET[2] * Math.max(mapCenterX, mapCenterY) * 7) /\n            (size.width / size.height) /\n            0.9\n\n        camera.position.set(mapCenterX + offsetX, offsetZ, mapCenterY + offsetY)\n        camera.lookAt(mapCenterX, 0, mapCenterY)\n    }, [mapId, size])\n\n    return (\n        <group>\n            <ambientLight intensity={2} color={new Color('#dbab93')} />\n            <pointLight\n                position={[6, 7, 8]}\n                intensity={2.2}\n                color={new Color('#c86b6f')}\n                shadow-mapSize-Height=\"1024\"\n                shadow-mapSize-width=\"1024\"\n                shadow-camera-far={30}\n                shadow-bias={-0.01}\n                castShadow\n                shadow-camera-left={-d}\n                shadow-camera-right={d}\n                shadow-camera-top={d}\n                shadow-camera-bottom={-d}\n            />\n            <pointLight position={[1, 3, 5]} intensity={2.2} color={new Color('#3a8dc2')} />\n        </group>\n    )\n}\n","import { ObjectInstance, MapData } from '../types/types'\nimport map0 from './map0.json'\nimport map1 from './map1.json'\nimport map2 from './map2.json'\n\nexport const maps: MapData[] = [\n    { id: 'map-0', name: 'Test 0', objects: map0 as any },\n    { id: 'map-1', name: 'Test 1', objects: map1 as any },\n    { id: 'map-2', name: 'Test 2', objects: map2 as any },\n]\n","import React, { Suspense, useEffect } from 'react'\nimport { Canvas } from 'react-three-fiber'\nimport { PCFSoftShadowMap } from 'three'\nimport { useEditor } from '../hooks/useEditor'\nimport { useGame } from '../hooks/useGame'\nimport { useKeyboardEvent } from '../hooks/useKeyboardEvent'\nimport { getDefinition } from '../objects/definitions'\nimport { DOWN, LEFT, RIGHT, UP } from '../types/consts'\nimport { DebugView } from './DebugView'\nimport { Environment } from './Environment'\nimport map1 from '../data/map1.json'\nimport map2 from '../data/map2.json'\nimport { ObjectInstance } from '../types/types'\nimport { CAMERA_OFFSET } from '../config'\nimport { maps } from '../data/maps'\n\nexport const GameInstance = () => {\n    const { objects, mapId, mapName, move, equip, grapple, fire, loadMap, reset } = useGame()\n    // a ja szukam jakiegos objaect map :(\n    const { editMode, toggleEditMode } = useEditor()\n    useKeyboardEvent('e', toggleEditMode)\n\n    const left = () => move(LEFT)\n    const up = () => move(UP)\n    const down = () => move(DOWN)\n    const right = () => move(RIGHT)\n\n    useKeyboardEvent('r', reset)\n\n    useKeyboardEvent('ArrowLeft', left)\n    useKeyboardEvent('ArrowUp', up)\n    useKeyboardEvent('ArrowDown', down)\n    useKeyboardEvent('ArrowRight', right)\n    useKeyboardEvent('Enter', equip)\n    useKeyboardEvent('Shift', grapple)\n    useKeyboardEvent(' ', fire)\n\n    let mapCenter = [0, 0]\n    objects.forEach(el => {\n        if (el.xy[0] > mapCenter[0]) mapCenter[0] = el.xy[0]\n        if (el.xy[1] > mapCenter[1]) mapCenter[1] = el.xy[0]\n    })\n    mapCenter = mapCenter.map(el => el / 2)\n    // TODO remove when menu will be added\n    useEffect(() => {\n        loadMap(maps[0])\n    }, [])\n\n    return (\n        <>\n            {editMode && <DebugView objects={objects} />}\n            <div\n                style={{\n                    position: 'absolute',\n                    zIndex: 5,\n                    top: 0,\n                    left: 0,\n                }}\n            >\n                {maps.map(map => (\n                    <button key={map.id} onClick={() => loadMap(map)}>\n                        Map {map.name}\n                    </button>\n                ))}\n            </div>\n            {mapName && (\n                <div\n                    style={{\n                        position: 'absolute',\n                        zIndex: 5,\n                        top: 0,\n                        right: 10,\n                    }}\n                >\n                    <h1>Map: {mapName}</h1>\n                </div>\n            )}\n            <div\n                style={{\n                    position: 'absolute',\n                    zIndex: 5,\n                    bottom: 0,\n                    left: 0,\n                    right: 0,\n                    textAlign: 'center',\n                }}\n            >\n                <button onClick={left}>\n                    <strong></strong>\n                </button>\n                <button onClick={up}>\n                    <strong></strong>\n                </button>\n                <button onClick={down}>\n                    <strong></strong>\n                </button>\n                <button onClick={right}>\n                    <strong></strong>\n                </button>\n                <button onClick={equip}>\n                    Equip <small>{`[enter]`}</small>\n                </button>\n                <button onClick={grapple}>\n                    Grapple <small>{`[shift]`}</small>\n                </button>\n                <button onClick={fire}>\n                    Fire <small>{'[space]'}</small>\n                </button>\n                <button onClick={reset}>\n                    Restart <small>{`[R]`}</small>\n                </button>\n            </div>\n            {mapId && (\n                <Canvas\n                    // orthographic\n                    camera={{\n                        zoom: 20,\n                    }}\n                    onCreated={scene => {\n                        scene.gl.shadowMap.type = PCFSoftShadowMap\n                        scene.gl.shadowMap.enabled = true\n                    }}\n                >\n                    <group>\n                        <Environment objectsList={objects} mapId={mapId} />\n                        <Suspense\n                            fallback={\n                                <mesh>\n                                    <boxBufferGeometry attach=\"geometry\" args={[0.5, 0.5, 0.5]} />\n                                    <meshStandardMaterial attach=\"material\" color=\"red\" />\n                                </mesh>\n                            }\n                        >\n                            {objects.map(obj => {\n                                const { Component3d } = getDefinition(obj.type)\n                                return <Component3d key={obj.id} instance={obj} />\n                            })}\n                        </Suspense>\n                    </group>\n                </Canvas>\n            )}\n        </>\n    )\n}\n","import { isEqual, uniqueId } from 'lodash'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { Action } from 'redux'\nimport { play } from '../audio/play'\nimport { PROJECTILE_ELEVATION } from '../config'\nimport { findById } from '../helpers'\nimport {\n    enqueue,\n    equip,\n    GameStateAware,\n    grapple,\n    loadMap,\n    move,\n    projectile,\n    reset,\n    rotate,\n} from '../state/gameReducer'\nimport { PLAYER_ID } from '../types/consts'\nimport { MapData, ObjectInstance, ObjectTypes, Vector2 } from '../types/types'\n\nexport const useGame = () => {\n    const state = useSelector((state: GameStateAware) => state.game)\n    const dispatch = useDispatch()\n    const player = findById(state.objects, PLAYER_ID)!\n\n    if (!player) console.warn(`Player don't exists`)\n\n    const triggerMove = (vector: Vector2) => {\n        if (state.queueStared) return\n\n        const actions: Action[] = []\n\n        if (!player) {\n            return console.warn(`Player don't exists`)\n        }\n\n        if (!isEqual(player.rotation, vector)) {\n            actions.push(rotate({ targetId: player.id, rotation: vector }))\n        } else {\n            actions.push(move({ targetId: player.id, vector }))\n        }\n\n        dispatch(enqueue(actions))\n    }\n\n    const triggerEquip = () => {\n        if (state.queueStared) return\n        dispatch(enqueue(equip({ targetId: player.id })))\n    }\n\n    const triggerGrapple = () => {\n        if (state.queueStared) return\n\n        if (!player.data.hasGrapple) {\n            play('Alert_NO')\n            return\n        }\n\n        dispatch(enqueue(grapple({ targetId: player.id })))\n    }\n\n    const triggerFire = () => {\n        if (state.queueStared) return\n        const { id, xy, rotation, elevation, data } = player\n\n        if (!data.hasCannon) {\n            play('Alert_NO')\n            return\n        }\n\n        const instance: ObjectInstance = {\n            type: ObjectTypes.RocketProjectile,\n            id: uniqueId(),\n            xy,\n            rotation,\n            elevation: elevation + PROJECTILE_ELEVATION,\n            aIndex: 100,\n            zIndex: 10,\n            data,\n        }\n\n        dispatch(enqueue(projectile({ byId: id, instance })))\n    }\n\n    const triggerLoadMap = (map: MapData) => {\n        dispatch(loadMap(map))\n    }\n\n    const triggerReset = () => {\n        dispatch(reset())\n    }\n\n    return {\n        ...state,\n        player,\n\n        loadMap: triggerLoadMap,\n        reset: triggerReset,\n\n        move: triggerMove,\n        equip: triggerEquip,\n        fire: triggerFire,\n        grapple: triggerGrapple,\n    }\n}\n","import React from 'react'\nimport { Provider } from 'react-redux'\nimport { store } from '../state/store'\nimport { GameInstance } from './GameInstance'\n\nexport const App = () => {\n    return (\n        <Provider store={store}>\n            <GameInstance />\n        </Provider>\n    )\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { App } from './app/App'\nimport './styles/global.css'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}